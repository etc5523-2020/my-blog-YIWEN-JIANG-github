---
title: COVID-19 on Canada
author: Yiwen Jiang
date: '2020-09-11'
slug: covid-19-on-canada
categories:
  - ETC5523 Blog
tags: []
subtitle: ''
summary: ''
authors: []
lastmod: '2020-09-11T13:00:29+10:00'
featured: no
image:
  caption: 'BY HRD'
  focal_point: ''
  preview_only: no
projects: []
bibliography: references.bib
runtime: shiny
---

```{r set-up, message=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = FALSE, messages=FALSE, warning=FALSE)
library(tidyverse)
library(lubridate)
library(highcharter)
library(shiny)
# devtools::install_github("ropenscilabs/rnaturalearth")
library(rnaturalearth)
library(plotly)
library(widgetframe)
library(kableExtra)
```

```{r read-data, message=FALSE}
canada_active <- read_csv(here::here("content/post/covid19canada/data/active_timeseries_canada.csv"))
prov_active <- read_csv(here::here("content/post/covid19canada/data/active_timeseries_prov.csv"))
canada_cases <- read_csv(here::here("content/post/covid19canada/data/cases_timeseries_canada.csv"))
prov_cases <- read_csv(here::here("content/post/covid19canada/data/cases_timeseries_prov.csv"))
canada_mortality <- read_csv(here::here("content/post/covid19canada/data/mortality_timeseries_canada.csv"))
prov_mortality <- read_csv(here::here("content/post/covid19canada/data/mortality_timeseries_prov.csv"))
canada_recovered <- read_csv(here::here("content/post/covid19canada/data/recovered_timeseries_canada.csv"))
prov_recovered <- read_csv(here::here("content/post/covid19canada/data/recovered_timeseries_prov.csv"))
canada_testing <- read_csv(here::here("content/post/covid19canada/data/testing_timeseries_canada.csv"))
prov_testing <- read_csv(here::here("content/post/covid19canada/data/testing_timeseries_prov.csv"))
```


The virus was confirmed to have reached Canada on January 27, 2020, after an individual who had returned to Toronto from Wuhan, Hubei, China, tested positive. As of August 19, 2020, there have been approximately 123,500 confirmed cases, over 109,000 recoveries and just over 9,000 deaths in the country. The Government of Canada has released modelling anticipating 11,000â€“22,000 deaths over the course of the pandemic, assuming "stronger epidemic control". 

Most of those cases are in Canada's two most populous provinces, Ontario and Quebec. Confirmed cases have been reported in all of Canada's provinces and territories, with the exception of Nunavut. An additional 13 cases involve repatriated citizens from the Grand Princess cruise ship. The first case of community transmission in Canada was confirmed in British Columbia on March 5, and Toronto's chief health officer announced on March 16 that there is "some evidence of community transmission".

In mid March, as cases of community transmission were confirmed, all of Canada's provinces and territories declared states of emergency. Provinces and territories have, to varying degrees, implemented school and daycare closures, prohibitions on gatherings, closures of non-essential businesses, restrictions on entry, and mandatory self-isolation for travellers.



```{r}
summary_table <- canada_active %>%
  filter(date_active == "10-09-2020") %>%
  select("Total Cases" = cumulative_cases,
         "Total Recovered" = cumulative_recovered,
         "Total Deaths" = cumulative_deaths,
         "Active Cases" = active_cases) 

summary_table$`Total Cases` <- scales::comma(summary_table$`Total Cases`, accuracy = 1)
summary_table$`Total Recovered` <- scales::comma(summary_table$`Total Recovered`, accuracy = 1)
summary_table$`Total Deaths` <- scales::comma(summary_table$`Total Deaths`, accuracy = 1)
summary_table$`Active Cases` <- scales::comma(summary_table$`Active Cases`, accuracy = 1)

summary_table %>%
  kable(caption = "Summary of COVID-19 data of Canada") %>%
  kable_classic(html_font = "Cambria") %>%
  kable_styling(full_width = 600, font_size = 24)
```


```{r}
canada_map <- ne_states(country = "Canada", returnclass = "sf") 
canada_map[2, 9] = "BC"
canada_map[10, 9] = "NL"
canada_map[12, 9] = "NWT"
canada_map[13, 9] = "PEI"
canada_map[6, 9] = "Quebec"
```

```{r, warning=FALSE}
test <- canada_map %>%
  inner_join(prov_active, by = c("name" = "province")) %>%
  filter(date_active == max(prov_active$date_active))

map <- plot_ly(test, split = ~name, color = ~cumulative_cases, colors = "OrRd", stroke = I("black"),
        text = ~paste("31-08-2020: ", "\n Total Cumulative \n Cases in ", name, "is ", cumulative_cases), 
        hoveron = "fills",
        hoverinfo = "text") %>%
  layout(showlegend = FALSE) 

widgetframe::frameWidget(map, width = 720)
```

```{r}
canada_cases %>%
  inner_join(canada_testing, by = c("date_report" = "date_testing")) %>%
  mutate(date = dmy(date_report)) %>%
  ggplot(aes(y = cases / testing, x = date)) +
  geom_point() +
  ylab("Positive Rate") +
  xlab("") +
  theme_light() +
  geom_smooth()
```



```{r}
daily_new <- prov_cases %>%
  left_join(prov_mortality, by = c("province" = "province", "date_report" = "date_death_report")) %>%
  left_join(prov_recovered, by = c("province" = "province", "date_report" = "date_recovered")) %>%
  left_join(prov_testing, by = c("province" = "province", "date_report" = "date_testing")) %>%
  select(province, date_report, "Cases" = cases)
```


```{r, fig.cap="Time series of COVID-19"}
time_series <- daily_new %>%
  mutate(Date = dmy(date_report)) %>%
  hchart("line", hcaes(x = Date, y = Cases, group = province))

widgetframe::frameWidget(time_series, width = 720)
```


```{r, eval=FALSE}
# devtools::install_github("hrbrmstr/streamgraph")
library(streamgraph)
 
# Create data:
data <- data.frame(
  year=rep(seq(1990,2016) , each=10),
  name=rep(letters[1:10] , 27),
  value=sample( seq(0,1,0.0001) , 270)
)
 
# Stream graph with a legend
streamgraph(data, key="name", value="value", date="year", height="300px", width="1000px") %>%
  sg_legend(show=TRUE, label="names: ")
```



```{r}
library(lubridate)
canada_testing %>%
  mutate(date = dmy(date_testing),
         week = wday(date, abbr = FALSE, label = TRUE, week_start = getOption("lubridate.week.start", 1))) %>%
  ggplot() +
  geom_boxplot(aes(x = week, y = testing, group = week))
```


```{r}
canada_cases %>%
  mutate(date = dmy(date_report),
         week = wday(date, abbr = FALSE, label = TRUE, week_start = getOption("lubridate.week.start", 1))) %>%
  ggplot() +
  geom_boxplot(aes(x = week, y = cases, group = week))
```


















